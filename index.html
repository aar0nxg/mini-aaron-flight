<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Aaron's Flight</title>
<style>
  html,body{margin:0;height:100%;background:#111;overflow:hidden;font-family:sans-serif;color:#fff}
  #hud{position:absolute;top:10px;left:10px;font-size:14px;line-height:1.5}
  #hud span{display:block}
  canvas{display:block;margin:0 auto;background:#000;width:100%;height:100%;object-fit:contain}
</style>
</head>
<body>
<div id="hud">
  <span id="km"></span>
  <span id="timer"></span>
</div>
<canvas id="game"></canvas>
<script>
(()=>{
  const canvas=document.getElementById('game'),ctx=canvas.getContext('2d');
  function resize(){
    const ratio=16/9;
    let w=window.innerWidth,h=window.innerHeight;
    if(w/h>ratio) w=h*ratio; else h=w/ratio;
    canvas.width=w; canvas.height=h;
  }
  window.addEventListener('resize',resize); resize();

  const kmEl=document.getElementById('km'),timerEl=document.getElementById('timer');
  const W=()=>canvas.width,H=()=>canvas.height;

  // Load sprites
  const chibiAaron=new Image(); chibiAaron.src="chibi-aaron.png";
  const hugImg=new Image(); hugImg.src="hug.png";

  let running=true,gameOver=false,victory=false;
  const plane={x:150,y:H()/2,vy:0,w:24,h:12,tilt:0};
  const gravity=20,thrust=40,maxVy=300;
  let hold=false;
  let obstacles=[];
  let spawnTimer=0,spawnInterval=2000;
  let last=0,elapsed=0;
  let kmRemaining=12000;
  const startTime=Date.now();

  // heart particles
  const particles=[];
  function spawnHeart(){
    particles.push({
      x:plane.x+20,y:plane.y,
      vx:-2-Math.random()*2,vy:-1-Math.random()*1,
      life:60
    });
  }
  function updateParticles(){
    for(let i=particles.length-1;i>=0;i--){
      const p=particles[i];
      p.x+=p.vx; p.y+=p.vy; p.life--;
      if(p.life<=0) particles.splice(i,1);
    }
  }
  function drawParticles(){
    ctx.font="16px sans-serif";
    particles.forEach(p=>{
      ctx.globalAlpha=Math.max(0,p.life/60);
      ctx.fillText("üíú",p.x,p.y);
    });
    ctx.globalAlpha=1;
  }

  function press(){hold=true;spawnHeart();}
  function release(){hold=false;}
  window.addEventListener('keydown',e=>{if(e.code==="Space")press();});
  window.addEventListener('keyup',e=>{if(e.code==="Space")release();});
  window.addEventListener('mousedown',press);
  window.addEventListener('mouseup',release);
  window.addEventListener('touchstart',e=>{e.preventDefault();press();},{passive:false});
  window.addEventListener('touchend',e=>{e.preventDefault();release();},{passive:false});

  function drawPlane(p){
    ctx.save();
    ctx.translate(p.x,p.y);
    ctx.rotate(p.tilt);

    // Rocket body
    ctx.fillStyle='#eee';
    ctx.beginPath();
    ctx.moveTo(-12,-6); ctx.lineTo(12,0); ctx.lineTo(-12,6); ctx.closePath();
    ctx.fill();

    // Mini Aaron riding on top
    if(chibiAaron.complete){
      const scale=0.08; // adjust size
      const w=chibiAaron.width*scale;
      const h=chibiAaron.height*scale;
      ctx.drawImage(chibiAaron,-w/2,-h-12,w,h);
    }

    ctx.restore();
  }

  function spawnObstacle(){
    const h=40+Math.random()*80;
    obstacles.push({x:W()+20,y:Math.random()*(H()-h-100)+50,w:30,h,speed:100+Math.random()*50});
  }
  function drawObstacle(o){
    ctx.fillStyle='#0ff';
    ctx.fillRect(o.x,o.y,o.w,o.h);
  }

  function drawVictory(){
    ctx.fillStyle='rgba(0,0,0,0.7)';
    ctx.fillRect(0,0,W(),H());
    ctx.textAlign='center';

    // Hug PNG
    if(hugImg.complete){
      const scale=Math.min(W()/hugImg.width, H()/hugImg.height)*0.6;
      const w=hugImg.width*scale;
      const h=hugImg.height*scale;
      ctx.drawImage(hugImg, W()/2-w/2, H()/2-h/2-30, w, h);
    }

    // Text
    ctx.fillStyle='#fff';
    ctx.font='28px system-ui,sans-serif';
    ctx.fillText('Victory! ‚úàÔ∏èüíû',W()/2,80);
    ctx.font='16px system-ui,sans-serif';
    ctx.fillText('Mini Aaron & Chandrima finally hug üíû',W()/2,110);
  }

  function drawOverlay(title,subtitle){
    ctx.fillStyle='rgba(0,0,0,0.7)';
    ctx.fillRect(0,0,W(),H());
    ctx.fillStyle='#fff'; ctx.textAlign='center';
    ctx.font='28px system-ui,sans-serif';
    ctx.fillText(title,W()/2,H()/2-40);
    ctx.font='16px system-ui,sans-serif';
    ctx.fillText(subtitle,W()/2,H()/2-10);
  }

  function update(dt){
    if(!running)return;
    elapsed+=dt;

    if(hold) plane.vy-=thrust*dt;
    plane.vy+=gravity*dt; 
    plane.vy=Math.max(-300,Math.min(maxVy,plane.vy));
    plane.y+=plane.vy*dt;
    if(plane.y<0)plane.y=0,plane.vy=0;
    if(plane.y>H()-20)plane.y=H()-20,plane.vy=0;
    plane.tilt=plane.vy/200;

    spawnTimer+=dt*1000;
    if(spawnTimer>spawnInterval){
      spawnTimer=0; spawnObstacle();
    }
    for(let i=obstacles.length-1;i>=0;i--){
      const o=obstacles[i]; o.x-=o.speed*dt;
      if(o.x<-o.w) obstacles.splice(i,1);
    }

    updateParticles();

    const t=(Date.now()-startTime)/1000;
    const speed=100; // km per sec
    kmRemaining=Math.max(0,12000-Math.floor(t*speed/60));
    kmEl.textContent=kmRemaining.toLocaleString()+" km";

    const m=Math.floor(t/60).toString().padStart(2,'0'),
          s=Math.floor(t%60).toString().padStart(2,'0');
    timerEl.textContent=`${m}:${s}`;

    if(kmRemaining<=0){victory=true;running=false;}
  }

  function render(){
    ctx.fillStyle='#001'; ctx.fillRect(0,0,W(),H());
    obstacles.forEach(drawObstacle);
    drawParticles();
    drawPlane(plane);
    if(gameOver) drawOverlay('Game Over üíî','Mini Aaron crashed!');
    if(victory) drawVictory();
  }

  function loop(ts){
    if(!last) last=ts;
    const dt=(ts-last)/1000; last=ts;
    update(dt); render();
    requestAnimationFrame(loop);
  }
  loop();
})();
</script>
</body>
</html>
