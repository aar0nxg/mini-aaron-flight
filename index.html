<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Mini Aaron Flight ‚úàÔ∏è Canada ‚Üí Bangladesh</title>
<style>
  :root{
    --bg:#0f0a1a; --ink:#efe8ff; --accent:#b87bff; --danger:#ff4d6d;
  }
  *{box-sizing:border-box}
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,Inter,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{display:flex;flex-direction:column;align-items:center;gap:8px;padding:12px}
  canvas{width:min(100vw - 24px,960px);height:auto;display:block;border-radius:14px;outline:1px solid rgba(255,255,255,.08);background:#120c22;touch-action:none}
  .hud{width:min(100vw - 24px,960px);display:flex;justify-content:space-between;align-items:center;gap:8px;font-size:14px;opacity:.9}
  .rec{display:flex;align-items:center;gap:6px;letter-spacing:.06em}
  .dot{width:10px;height:10px;border-radius:50%;background:#ff3b3b;box-shadow:0 0 10px #ff3b3b}
  .tip{font-size:12px;opacity:.8}
  .btnbar{width:min(100vw - 24px,960px);display:flex;justify-content:space-between;gap:8px}
  button{background:#24153f;color:var(--ink);border:1px solid rgba(255,255,255,.14);padding:10px 12px;border-radius:10px;font-weight:600;cursor:pointer}
  button:hover{background:#2c1f52}
</style>
</head>
<body>
<div class="wrap">
  <div class="hud">
    <div class="rec"><span class="dot"></span><span>&lt;REC&gt;</span></div>
    <div><strong>Canada ‚Üí Bangladesh</strong> ‚Ä¢ <span id="km">12000</span> km to go</div>
    <div>‚è±Ô∏è <span id="timer">00:00</span></div>
  </div>
  <canvas id="game" width="960" height="540" aria-label="Mini Aaron flight game"></canvas>
  <div class="btnbar">
    <button id="playPause">Pause</button>
    <div class="tip">Tap/hold or press Space/‚Üë to fly up ‚Ä¢ Avoid clouds & birds ‚Ä¢ Reach üáßüá© for the hug üíú</div>
  </div>
</div>

<script>
(() => {
  // ===== Canvas setup (retina-safe) =====
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  let DPR = Math.max(1, window.devicePixelRatio || 1);
  function resizeCanvas() {
    const w = 960, h = 540;
    DPR = Math.max(1, window.devicePixelRatio || 1);
    canvas.width = w * DPR; canvas.height = h * DPR;
    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
  }
  resizeCanvas(); addEventListener('resize', resizeCanvas);

  // ===== HUD =====
  const kmEl = document.getElementById('km');
  const timerEl = document.getElementById('timer');
  const playBtn = document.getElementById('playPause');

  // ===== Game constants =====
  const W = 960, H = 540, SKY_TOP = 40, GROUND_Y = H - 80;
  const gravity = 0.38, thrust = 0.8, maxVy = 7;
  const baseScroll = 4.2;
  const totalDistanceKm = 12000;
  let kmRemaining = totalDistanceKm;

  // distance compress (finish ~2 min)
  const displayKmPerSecStart = 120;
  const displayKmPerSecEnd = 160;

  // Player
  const plane = { x: Math.round(W*0.22), y: Math.round(H*0.5), vy: 0, w: 60, h: 36, tilt: 0 };

  // Obstacles
  const obstacles = [];
  let spawnTimer = 0, spawnInterval = 1100, worldSpeed = baseScroll, difficulty = 1;

  // Background parallax
  const bgClouds = Array.from({length: 6}, () => ({
    x: Math.random()*W, y: 60 + Math.random()*220, r: 30+Math.random()*40, s: 0.5+Math.random()*0.9
  }));

  // State
  let running = true, gameOver = false, victory = false;
  let startedAt = performance.now(), last = performance.now(), hold = false;

  // Input
  function press(){ hold = true; }
  function release(){ hold = false; }
  addEventListener('keydown', e=>{
    if (e.code==='Space'||e.code==='ArrowUp'){ e.preventDefault(); press(); }
    if (e.code==='KeyP') togglePause();
    if (e.code==='Enter' && (gameOver||victory)) resetGame();
  }, {passive:false});
  addEventListener('keyup', e=>{
    if (e.code==='Space'||e.code==='ArrowUp'){ e.preventDefault(); release(); }
  }, {passive:false});
  canvas.addEventListener('pointerdown', ()=>press(), {passive:true});
  addEventListener('pointerup', ()=>release(), {passive:true});
  document.addEventListener('visibilitychange', ()=>{ if (document.hidden) setRunning(false); });
  playBtn.addEventListener('click', ()=>togglePause());

  function togglePause(){ if (victory||gameOver){ resetGame(); return; } setRunning(!running); }
  function setRunning(v){ running = v; playBtn.textContent = v?'Pause':'Resume'; if(v){ last=performance.now(); loop(); } }
  function resetGame(){
    obstacles.length=0; plane.y=Math.round(H*0.5); plane.vy=0; plane.tilt=0;
    spawnTimer=0; spawnInterval=1100; worldSpeed=baseScroll; difficulty=1;
    kmRemaining=totalDistanceKm; startedAt=performance.now();
    gameOver=false; victory=false; running=true; playBtn.textContent='Pause'; last=performance.now(); loop();
  }

  // Helpers
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
  const lerp = (a,b,t)=>a+(b-a)*t;
  const ease = t=>t<.5 ? 2*t*t : 1 - Math.pow(-2*t+2,2)/2;
  const tElapsedSec = ()=> (performance.now()-startedAt)/1000;

  // Spawn
  function spawnObstacle(){
    const r = Math.random(); let type,w,h,y,speedMul;
    if (r<0.55){ type='cloud'; w=90+Math.random()*80; h=50+Math.random()*30;
      y=SKY_TOP+Math.random()*(GROUND_Y-200-SKY_TOP); speedMul=1;
    } else if (r<0.85){ type='bird'; w=44; h=28;
      y=SKY_TOP+60+Math.random()*(GROUND_Y-160-SKY_TOP); speedMul=1.35;
    } else { type='storm'; w=50; h=120+Math.random()*120;
      const top=Math.random()<0.5; y=top?SKY_TOP:(GROUND_Y-h); speedMul=1.1;
    }
    obstacles.push({type,x:W+40,y,w,h,speed:worldSpeed*speedMul});
  }

  // Collision (shrunken hitbox)
  function hit(a,b){
    const shrink=0.8, ax=a.x-(a.w*(1-shrink)/2), ay=a.y-(a.h*(1-shrink)/2),
          aw=a.w*shrink, ah=a.h*shrink;
    return ax<b.x+b.w && ax+aw>b.x && ay<b.y+b.h && ay+ah>b.y;
  }

  // Drawing helpers
  function cloudShape(x,y,r){
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI*2);
    ctx.arc(x+r*0.9, y+6, r*0.8, 0, Math.PI*2);
    ctx.arc(x-r*0.9, y+10, r*0.7, 0, Math.PI*2);
    ctx.closePath(); ctx.fill();
  }
  function roundedRect(x,y,w,h,r){ const rr=Math.min(r,w/2,h/2);
    ctx.beginPath(); ctx.moveTo(x+rr,y);
    ctx.arcTo(x+w,y,x+w,y+h,rr); ctx.arcTo(x+w,y+h,x,y+h,rr);
    ctx.arcTo(x,y+h,x,y,rr); ctx.arcTo(x,y,x+w,y,rr); ctx.fill();
  }
  function drawSky(){
    const g=ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,'#1a1140'); g.addColorStop(1,'#0c0830');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    ctx.globalAlpha=.35; for(let i=0;i<80;i++){ const x=(i*97)%W, y=(i*53)%(H-160)+20; ctx.fillStyle='rgba(255,255,255,.9)'; ctx.fillRect(x,y,2,2); }
    ctx.globalAlpha=1;
    bgClouds.forEach(c=>{ c.x-=c.s*0.6; if(c.x<-120) c.x=W+60; ctx.fillStyle='rgba(255,255,255,0.08)'; cloudShape(c.x,c.y,c.r); });
    ctx.fillStyle='#0d0929'; ctx.fillRect(0,GROUND_Y+24,W,H-(GROUND_Y+24));
  }
  function drawPlane(p){
    ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.tilt);
    ctx.fillStyle='#e6d4ff'; roundedRect(-30,-14,60,28,12);
    ctx.fillStyle='#b87bff'; ctx.beginPath(); ctx.ellipse(25,0,14,12,0,0,Math.PI*2); ctx.fill();
    ctx.fillStyle='#caa8ff'; roundedRect(-6,4,32,10,5); roundedRect(-28,-12,16,8,4);
    ctx.fillStyle='#3b2c5f'; roundedRect(2,-6,18,12,4);
    ctx.fillStyle='#ffe4f1'; ctx.fillRect(6,-2,4,4);
    ctx.restore();
  }
  function drawObstacle(o){
    if(o.type==='cloud'){ ctx.fillStyle='rgba(255,255,255,0.18)'; cloudShape(o.x+o.w/2,o.y+o.h/2,Math.max(o.w,o.h)/2); }
    else if(o.type==='bird'){ ctx.fillStyle='#ffd8e1'; roundedRect(o.x,o.y,o.w,o.h,8); ctx.fillStyle='#ff9aa7'; ctx.fillRect(o.x+o.w-6,o.y+o.h/2-2,8,4); }
    else{ ctx.fillStyle='rgba(184,123,255,0.25)'; roundedRect(o.x,o.y,o.w,o.h,10);
          ctx.strokeStyle='rgba(255,230,120,0.5)'; ctx.beginPath(); ctx.moveTo(o.x+o.w/2,o.y+6);
          ctx.lineTo(o.x+o.w/2-6,o.y+28); ctx.lineTo(o.x+o.w/2+4,o.y+48); ctx.stroke(); }
  }
  function drawScanlines(){ ctx.save(); ctx.globalAlpha=0.08; ctx.fillStyle='#000'; for(let y=0;y<H;y+=4) ctx.fillRect(0,y,W,1); ctx.restore(); }
  function drawProgressBar(){
    const pad=20, y=H-28, w=W-pad*2, p=(totalDistanceKm-kmRemaining)/totalDistanceKm;
    ctx.fillStyle='rgba(255,255,255,0.12)'; roundedRect(pad,y,w,10,5);
    ctx.fillStyle='#b87bff'; roundedRect(pad,y,Math.max(10,w*p),10,5);
    ctx.font='14px sans-serif'; ctx.globalAlpha=.9; ctx.fillText('üá®üá¶',pad-2,y+9); ctx.fillText('üáßüá©',W-pad-16,y+9); ctx.globalAlpha=1;
    const px = pad + w*p; ctx.fillStyle='#e6d4ff'; ctx.beginPath(); ctx.moveTo(px,y-8); ctx.lineTo(px-6,y-2); ctx.lineTo(px+6,y-2); ctx.fill();
  }
  function drawOverlay(text,sub,showRestart){
    ctx.save(); ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(0,0,W,H);
    ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.font='bold 32px system-ui,sans-serif'; ctx.fillText(text,W/2,H/2-10);
    ctx.font='16px system-ui,sans-serif'; ctx.fillText(sub,W/2,H/2+16); if(showRestart) ctx.fillText('Press Enter or tap to restart',W/2,H/2+42); ctx.restore();
  }
  function drawVictory(){
    const g=ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,'#2b174f'); g.addColorStop(1,'#200c35');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    for(let i=0;i<40;i++){ const x=(i*137+performance.now()/30)%W, y=(i*71%(H-200))+40; ctx.globalAlpha=(Math.sin((performance.now()/300+i)*0.7)+1)/4+0.2; ctx.fillStyle='#ff86a6'; ctx.fillRect(x,y,2,2); }
    ctx.globalAlpha=1;
    const cx=W/2, base=H/2+30, bounce=Math.sin(performance.now()/350)*2;
    const chibi=(x,skin,outfit,off)=>{ ctx.fillStyle=outfit; roundedRect(x-20,base-40+bounce,40,60,14); ctx.fillStyle=skin; ctx.beginPath(); ctx.arc(x,base-60+bounce,22,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='#2a1c3e'; ctx.fillRect(x-8+off,base-64+bounce,4,6); ctx.fillRect(x+4+off,base-64+bounce,4,6);
      ctx.strokeStyle='#c9b6ff'; ctx.strokeRect(x-10+off,base-68+bounce,10,10); ctx.strokeRect(x+2+off,base-68+bounce,10,10); ctx.beginPath(); ctx.moveTo(x+0+off,base-63+bounce); ctx.lineTo(x+2+off,base-63+bounce); ctx.stroke();
    };
    chibi(cx-26,'#ffe6cc','#5a3a85',-2); chibi(cx+26,'#ffe0d8','#ff8fb1',2);
    ctx.strokeStyle='#ffd6ea'; ctx.lineWidth=6; ctx.beginPath();
    ctx.moveTo(cx-46,base-28+bounce); ctx.quadraticCurveTo(cx-24,base-6+bounce,cx,base-6+bounce);
    ctx.moveTo(cx+46,base-28+bounce); ctx.quadraticCurveTo(cx+24,base-6+bounce,cx,base-6+bounce); ctx.stroke();
    ctx.fillStyle='#fff'; ctx.textAlign='center'; ctx.font='bold 24px system-ui,sans-serif'; ctx.fillText('Made it to Bangladesh!',W/2,80);
    ctx.font='16px system-ui,sans-serif'; ctx.fillText('Mini Aaron & Zarifa finally hug üíû',W/2,106);
    ctx.font='14px system-ui,sans-serif'; ctx.fillText('Press Enter or tap to play again',W/2,132);
  }

  // Main loop
  function loop(){
    if(!running) return;
    const now=performance.now(), dtMs=now-last, dt=Math.min(48,dtMs)/16.6667; last=now;
    update(dtMs,dt); render(); if(running) requestAnimationFrame(loop);
  }

  function update(dtMs,dt){
    if(gameOver||victory) return;
    difficulty += 0.00045 * dtMs;
    worldSpeed = baseScroll * (1 + (difficulty-1)*0.35);
    spawnInterval = Math.max(580, 1100 - (difficulty-1)*160);

    plane.vy += gravity*dt; if(hold) plane.vy -= thrust*dt;
    plane.vy = clamp(plane.vy,-maxVy,maxVy); plane.y += plane.vy*3.2;
    plane.y = clamp(plane.y,SKY_TOP+20,GROUND_Y-20); plane.tilt = clamp((-plane.vy)/18,-0.35,0.35);

    spawnTimer += dtMs; if(spawnTimer>=spawnInterval){ spawnTimer=0; spawnObstacle(); }
    for(let i=obstacles.length-1;i>=0;i--){ const o=obstacles[i]; o.x -= o.speed*3.2; if(o.x+o.w<-10) obstacles.splice(i,1);
      if(hit({x:plane.x-30,y:plane.y-18,w:60,h:36},o)){ gameOver=true; setRunning(false); }
    }

    const prog=(totalDistanceKm-kmRemaining)/totalDistanceKm;
    const kmPerSec = lerp(displayKmPerSecStart,displayKmPerSecEnd,ease(prog));
    kmRemaining = Math.max(0, kmRemaining - kmPerSec*(dtMs/1000));
    kmEl.textContent = Math.ceil(kmRemaining);

    const t=Math.floor((performance.now()-startedAt)/1000), mm=String(Math.floor(t/60)).padStart(2,'0'), ss=String(t%60).padStart(2,'0');
    timerEl.textContent = `${mm}:${ss}`;
    if(kmRemaining<=0){ victory=true; setRunning(false); }
  }

  function render(){
    drawSky();
    ctx.fillStyle='rgba(255,255,255,0.8)'; ctx.font='14px system-ui,sans-serif'; ctx.fillText('Canada ‚Üí Bangladesh',18,24);
    obstacles.forEach(drawObstacle);
    drawPlane(plane);
    drawProgressBar();
    drawScanlines();
    ctx.strokeStyle='rgba(255,255,255,0.08)'; ctx.strokeRect(8,8,W-16,H-16);
    if(gameOver) drawOverlay('Plane hit something! üí•','Tip: hold to climb, release to glide.',true);
    else if(victory) drawVictory();
  }

  loop();
  canvas.addEventListener('click',()=>{ if(gameOver||victory) resetGame(); });
})();
</script>
</body>
</html>
