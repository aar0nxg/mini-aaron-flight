<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Mini Flight: Fly to Zarifa</title>
<style>
  :root{ --bg-1:#0b0820; --bg-2:#160f32; --bg-3:#201443; --accent:#ff5a7a; --accent-2:#b084ff; }
  html,body{height:100%;margin:0;background:
    radial-gradient(1600px 100% at 50% 0%,rgba(255,255,255,.05),transparent),
    linear-gradient(180deg,var(--bg-1),var(--bg-2) 60%,var(--bg-3));
    color:#fff;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;}

  #gameRoot{position:relative;max-width:960px;margin:0 auto;height:100vh;overflow:hidden;
    box-shadow:0 8px 40px rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.07);border-radius:16px}
  canvas{display:block;width:100%;height:100%;outline:none}

  .hud{position:absolute;top:12px;left:12px;display:flex;gap:10px;z-index:5}
  .pill{background:rgba(0,0,0,.35);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.15);padding:8px 12px;border-radius:999px}
  .hud-right{position:absolute;top:12px;right:12px;display:flex;gap:10px;z-index:6}
  .btn{cursor:pointer;user-select:none}
  .bar{--p:0;position:relative;height:10px;width:240px;border-radius:999px;background:rgba(255,255,255,.15);overflow:hidden}
  .bar::after{content:"";position:absolute;inset:0;width:calc(var(--p)*1%);background:linear-gradient(90deg,var(--accent),var(--accent-2))}
  .rec{position:absolute;top:14px;right:14px;color:#ff4d4d;font-weight:800;text-shadow:0 0 10px #ff4d4d80}
  .rec::before{content:"‚óè ";}

  .overlay{position:absolute;inset:0;display:grid;place-items:center;background:rgba(10,0,20,.78);z-index:10;transition:opacity .25s}
  .overlay.hidden{opacity:0;pointer-events:none}
  .card{background:rgba(255,255,255,.07);padding:28px;border-radius:16px;text-align:center;border:1px solid rgba(255,255,255,.15);max-width:720px}
  .action{border:none;padding:12px 18px;border-radius:12px;font-weight:800;cursor:pointer;background:linear-gradient(180deg,var(--accent),#ff87a0);color:#fff}

  .holdZone{position:absolute;bottom:18px;left:50%;transform:translateX(-50%);z-index:7;background:rgba(255,255,255,.08);
            border:1px solid rgba(255,255,255,.2);backdrop-filter:blur(6px);padding:10px 16px;border-radius:999px;user-select:none}
  .hint{opacity:.85;font-size:12px;margin-top:6px}

  html, body, #gameRoot, canvas {
    touch-action: none; -ms-touch-action: none; overscroll-behavior: none;
    user-select: none; -webkit-user-select: none; -webkit-touch-callout: none;
  }
  * { -webkit-tap-highlight-color: transparent; }

  /* ‚ú® Tiny sparkle hearts */
  .heartBurst{position:absolute;left:50%;bottom:72px;pointer-events:none;z-index:8}
  .heart{position:absolute;font-size:16px;opacity:0.9;text-shadow:0 0 8px rgba(255,90,122,.45), 0 0 14px rgba(176,132,255,.35);
    animation:riseHeart 1.1s ease-out forwards}
  @keyframes riseHeart{
    0%{transform:translate(-50%,0) scale(.9); opacity:.0}
    10%{opacity:.95}
    70%{opacity:.85}
    100%{transform:translate(-50%,-110px) scale(1.05); opacity:0}
  }
</style>
</head>
<body>
<div id="gameRoot">
  <canvas id="game" tabindex="0" aria-label="Mini Flight Game"></canvas>

  <div class="hud">
    <div class="pill" id="livesPill">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    <div class="pill">‚úàÔ∏è Dist: <span id="km">10,000</span></div>
    <div class="pill bar" id="progress"></div>
  </div>
  <div class="hud-right">
    <div class="pill btn" id="pauseBtn" title="Pause/Resume">‚è∏Ô∏è</div>
    <div class="pill btn" id="muteBtn" title="Mute/Unmute">üîä</div>
  </div>
  <div class="rec">REC</div>

  <div class="holdZone" id="holdZone">Hold to fly ‚Üë ‚Ä¢ Space / ‚Üë / W also work</div>

  <!-- Start -->
  <div class="overlay" id="start">
    <div class="card">
      <h1 style="margin:0 0 8px">The Flight ‚úàÔ∏èüíú</h1>
      <p style="margin:0">Hold <b>Space / ‚Üë / W</b> or <b>hold screen/trackpad</b> to go up. Dodge meteors, birds, satellites, clouds, and gusts!</p>
      <p class="hint">3 lives. Hit = lose a heart. At 0 ‚Üí <b>Game Over</b>. Reach Zarifa ‚Üí <b>HUG WIN</b>.</p>
      <button class="action" id="playBtn">üé¨ Fly!</button>
    </div>
  </div>

  <!-- Game Over -->
  <div class="overlay hidden" id="gameover">
    <div class="card">
      <h2 style="margin:0 0 8px">Game Over üíî</h2>
      <p style="margin:0 0 12px">Press the button to try again.</p>
      <div style="display:flex;gap:8px;justify-content:center">
        <button class="action" id="retryBtn">‚Üª Restart</button>
      </div>
    </div>
  </div>

  <!-- Win -->
  <div class="overlay hidden" id="win">
    <div class="card">
      <h2 id="winTitle" style="margin:0 0 10px">Hug time! üíñ</h2>
      <img id="hugImg" src="" alt="Hug" style="image-rendering:pixelated;max-width:320px;width:100%;height:auto;border-radius:8px;border:1px solid rgba(255,255,255,.2);" />
      <div id="hugFallback" style="display:none; margin:0 auto; max-width:320px">
        <svg viewBox="0 0 240 160" width="320" height="214" style="image-rendering:pixelated">
          <rect width="240" height="160" fill="#1a0f2c"/>
          <g fill="#ff7ea0"><rect x="88" y="34" width="8" height="8"/><rect x="144" y="34" width="8" height="8"/>
          <rect x="80" y="42" width="72" height="8"/><rect x="72" y="50" width="88" height="8"/>
          <rect x="72" y="58" width="88" height="8"/><rect x="80" y="66" width="72" height="8"/><rect x="96" y="74" width="40" height="8"/></g>
          <g><rect x="84" y="84" width="24" height="18" fill="#ffd7c8"/><rect x="90" y="90" width="12" height="3" fill="#2a2451"/>
          <rect x="92" y="93" width="2" height="2" fill="#0e0b2b"/><rect x="99" y="93" width="2" height="2" fill="#0e0b2b"/>
          <rect x="84" y="102" width="24" height="16" fill="#3a2b6d"/><rect x="92" y="112" width="16" height="4" fill="#ffd7c8"/></g>
          <g><rect x="128" y="84" width="24" height="18" fill="#ffd7c8"/><rect x="134" y="90" width="12" height="3" fill="#2a2451"/>
          <rect x="136" y="93" width="2" height="2" fill="#0e0b2b"/><rect x="143" y="93" width="2" height="2" fill="#0e0b2b"/>
          <rect x="128" y="102" width="24" height="16" fill="#3a2b6d"/><rect x="136" y="112" width="16" height="4" fill="#ffd7c8"/></g>
        </svg>
      </div>
      <button class="action" id="againBtn" style="margin-top:12px">üíû Fly Again</button>
    </div>
  </div>

  <div class="heartBurst" id="hearts"></div>
</div>

<script>
const canvas=document.getElementById("game"), ctx=canvas.getContext("2d");
let cw, ch;
function resize(){cw=canvas.width=canvas.offsetWidth; ch=canvas.height=canvas.offsetHeight;}
window.addEventListener("resize", resize); resize();

// Game state
let lives=3, km=0, maxKm=10000, flying=false, gameOver=false, gameWin=false;

// Images
const imgAaron=new Image(); imgAaron.src="aaron.png";
const imgZarifa=new Image(); imgZarifa.src="zarifa.png";
const imgHug=new Image(); imgHug.src="hug_aaron.png";

// Player
const player={x:100,y:ch/2,w:40,h:40,vy:0};

// Key/hold controls
let keys={};
document.addEventListener("keydown",e=>{if(["ArrowUp","KeyW","Space"].includes(e.code)) keys.up=true;});
document.addEventListener("keyup",e=>{if(["ArrowUp","KeyW","Space"].includes(e.code)) keys.up=false;});
const holdZone=document.getElementById("holdZone");
holdZone.addEventListener("mousedown",()=>keys.up=true);
holdZone.addEventListener("mouseup",()=>keys.up=false);
holdZone.addEventListener("touchstart",()=>keys.up=true);
holdZone.addEventListener("touchend",()=>keys.up=false);

// HUD
const livesPill=document.getElementById("livesPill");
const kmSpan=document.getElementById("km");
const progress=document.getElementById("progress");

// Overlays
const startOverlay=document.getElementById("start");
const playBtn=document.getElementById("playBtn");
const gameoverOverlay=document.getElementById("gameover");
const retryBtn=document.getElementById("retryBtn");
const winOverlay=document.getElementById("win");
const hugImg=document.getElementById("hugImg");
const hugFallback=document.getElementById("hugFallback");
const againBtn=document.getElementById("againBtn");

// Start game
playBtn.onclick=startGame;
retryBtn.onclick=startGame;
againBtn.onclick=startGame;

function startGame(){
  startOverlay.classList.add("hidden");
  gameoverOverlay.classList.add("hidden");
  winOverlay.classList.add("hidden");
  lives=3; km=0; flying=true; gameOver=false; gameWin=false;
  player.y=ch/2; player.vy=0;
}

// Game loop
function update(){
  if(!flying) return;
  // physics
  if(keys.up) player.vy-=0.6; else player.vy+=0.4;
  player.vy*=0.9; player.y+=player.vy;
  if(player.y<0) player.y=0; if(player.y+player.h>ch) player.y=ch-player.h;

  // distance
  km+=5;
  if(km>=maxKm){gameWin=true; flying=false; showWin();}
  kmSpan.textContent=Math.min(km,maxKm);
  progress.style.setProperty("--p", Math.min(km/maxKm*100,100));

  // lives
  if(lives<=0){gameOver=true; flying=false; showGameOver();}
}

function draw(){
  ctx.clearRect(0,0,cw,ch);
  // player
  ctx.drawImage(imgAaron,player.x,player.y,player.w,player.h);
  // goal (Zarifa)
  ctx.drawImage(imgZarifa,cw-100,ch/2-40,80,80);
}

function loop(){
  update(); draw();
  requestAnimationFrame(loop);
}

function showGameOver(){gameoverOverlay.classList.remove("hidden");}
function showWin(){
  winOverlay.classList.remove("hidden");
  hugImg.onload=()=>{hugImg.style.display="block"; hugFallback.style.display="none";}
  hugImg.onerror=()=>{hugImg.style.display="none"; hugFallback.style.display="block";}
  hugImg.src=imgHug.src;
}

loop();
</script>
</body>
</html>
